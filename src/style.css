/* 使用CSS ::before伪元素添加内链引用图标 */
.protyle-wysiwyg [data-node-id] span[data-type='block-ref'][data-icon-name]::before {
    content: "";
    display: inline-block;
    width: 1.2em;
    height: 1.2em;
    margin-right: 0.2em;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    vertical-align: baseline;
}

/* 文档图标 - SVG类型 */
.protyle-wysiwyg [data-node-id] span[data-type='block-ref'][data-icon-name='#iconFile']::before {
    background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23ccc" d="M13.5,6.37v-1.87c0-.63.06-1,.18-1.22s.31-.28.57-.28c.74,0,2.06.83,3.18,1.9s2.07,2.38,2.07,3.35c0,.26-.06.45-.28.57s-.59.18-1.22.18h-1.87c-1.31,0-1.97,0-2.3-.33s-.33-.99-.33-2.3ZM18,10.5h-1.88c-2.06,0-3.09,0-3.61-.52s-.52-1.55-.52-3.61v-1.87c0-.74,0-1.12-.2-1.31s-.57-.19-1.31-.19c-3,.02-4.49.15-5.24,1.15s-.75,2.87-.75,6.35v3c0,3.75,0,5.62.94,6.56s2.81.94,6.56.94,5.62,0,6.56-.94.94-2.81.94-6.56v-1.5c0-.74,0-1.11-.19-1.31s-.57-.19-1.31-.19"></path></svg>');
    vertical-align: text-top;
}

.protyle-wysiwyg [data-node-id] span[data-type='block-ref'][data-icon-name='#iconFolder']::before {
    background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23ccc" d="M20.97,16.49c-.32,2.25-.48,3.38-1.13,3.94s-1.79.56-4.06.56h-7.55c-2.28,0-3.41,0-4.06-.56s-.81-1.69-1.13-3.94c-.43-2.99-.64-4.49,0-5.24s2.16-.75,5.19-.75h7.55c3.02,0,4.54,0,5.19.75s.44,2.25.01,5.24h0ZM5.25,9h13.5c.59,0,.97-.08,1.19-.31s.31-.6.31-1.19-.08-.97-.31-1.19-.6-.31-1.19-.31h-2.19s-2.19,0-2.19,0c-.51,0-.86-.04-1.17-.17s-.59-.35-.94-.71l-.62-.62-.62-.62c-.36-.36-.64-.58-.95-.71s-.66-.17-1.17-.17h-1.07s-1.07.01-1.07.01c-1.18,0-1.93.16-2.39.61s-.61,1.2-.61,2.39v1.5c0,.59.08.97.31,1.19s.6.31,1.19.31"></path></svg>');
    vertical-align: text-top;
}

/* Emoji Unicode处理 - 基础规则 */
.protyle-wysiwyg [data-node-id] span[data-type='block-ref'][data-icon-name='emoji']::before {
    content: attr(data-icon-emoji);
    background-image: none;
    font-size: 1em;
    font-family: 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', sans-serif;
    vertical-align: baseline;
}

/* 其他CSS保持不变 */
.custom-icon-upload {
    font-family: Arial, sans-serif;
    margin: 10px auto;
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 5px;

    flex: 1;
    max-width: 500px;

    & h3 {
        margin-top: 0;
        margin-bottom: 20px;
        text-align: center;
    }

    & .input-group {
        margin-bottom: 15px;

        & label {
            display: block;
            margin-bottom: 5px;
        }

        & input {
            width: 100%;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
    }

    & #file-preview {
        margin-bottom: 15px;
        text-align: center;

        & img {
            max-width: 100px;
            max-height: 100px;
        }
    }

    & #upload-button {
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: 3px;
        cursor: pointer;

        &:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
    }
}

/* ================================== */

.protyle-wysiwyg [data-node-id] span[data-type~='a']:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url']:not(:empty)::before,
.b3-typography a:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a:not(:empty)::before {
    display: inline-block;
    position: relative;
    background-repeat: no-repeat;
    background-size: 1em 1em;
    top: 0.2em !important;
    width: 1em;
    height: 1em;
    margin-right: 0.2em !important;
}

/* 特殊协议图标 */
.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href^="es://"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href^="es://"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href^="es://"]::before,
.b3-typography a[href^="es://"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/everything.svg');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href^="zotero://"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href^="zotero://"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href^="zotero://"]::before,
.b3-typography a[href^="zotero://"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/zotero.ico');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href^="bookxnotepro://"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href^="bookxnotepro://"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href^="bookxnotepro://"]::before,
.b3-typography a[href^="bookxnotepro://"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/bookxnote.ico');
}

/* 文件系统图标 */
.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href^="file://"][data-href $="/"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href^="file://"][data-href $="/"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href^="file://"][data-href $="/"]::before,
.b3-typography a[href^="file://"][data-href $="/"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/folder.svg');
    opacity: 0.9;
    background-size: 1.2em 1.2em;
    filter: hue-rotate(0.9turn);
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href ^="file://"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href ^="assets/"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href ^="file://"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href ^="assets/"]:not(:empty)::before,
.b3-typography a[href ^="assets/"]::before,
.protyle-wysiwyg [data-node-id] a[href^="http://127.0.0.1:6806/assets/"]::before,
.protyle-wysiwyg [data-node-id] a[href^="assets/"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/unknown.svg');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href ^="assets"][data-href $="/"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href ^="assets"][data-href $="/"]:not(:empty)::before,
.b3-typography a[href ^="assets"][href $="/"]::before,
.protyle-wysiwyg [data-node-id] a[href^="assets/"][href $="/"]::before,
.protyle-wysiwyg [data-node-id] a[href^="http://127.0.0.1:6806/assets/"][href $="/"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/assets.svg');
}

/* 文件类型图标 */
.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".zip"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".zip"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".zip"]::before,
.b3-typography a[href ^="assets/"][href $=".zip"]::before,
.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".tar"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".tar"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".tar"]::before,
.b3-typography a[href ^="assets/"][href $=".tar"]::before,
.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".tar.gz"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".tar.gz"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".tar.gz"]::before,
.b3-typography a[href ^="assets/"][href $=".tar.gz"]::before,
.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".gz"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".gz"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".gz"]::before,
.b3-typography a[href ^="assets/"][href $=".gz"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/compress.svg');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".pdf"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".pdf"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".pdf"]::before,
.b3-typography [href ^="assets/"][href $=".pdf"]::before,
.protyle-wysiwyg [data-node-id] span[data-type~=a][data-href*=".pdf?page"]:not(:empty):before,
.protyle-wysiwyg [data-node-id] span[data-type~=url][data-href*=".pdf?page"]:not(:empty):before,
.protyle-wysiwyg [data-node-id] a[href=".pdf?page"]:before,
.b3-typography [href^="assets/"][href*=".pdf?page"]:before
{
    content: "";
    background-image: url('plugins/link-icon/icon/pdf.svg');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".mp4"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".mp4"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".mp4"]::before,
.b3-typography [href ^="assets/"][href $=".mp4"]::before,
.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".flv"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".flv"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $="flv"]::before,
.b3-typography [href ^="assets/"][href $=".flv"]::before,
.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".mkv"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".mkv"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".mkv"]::before,
.b3-typography [href ^="assets/"][href $=".mkv"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/videos.svg');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".xlsx"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".xlsx"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".xlsx"]::before,
.b3-typography [href ^="assets/"][href $=".xlsx"]::before,
.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".xls"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".xls"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".xls"]::before,
.b3-typography [href ^="assets/"][href $=".xls"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/excel_icon.svg');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".pptx"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".pptx"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".pptx"]::before,
.b3-typography [href ^="assets/"][href $=".pptx"]::before,
.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".ppt"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".ppt"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".ppt"]::before,
.b3-typography [href ^="assets/"][href $=".ppt"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/powerpoint_icon.svg');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".docx"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".docx"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".docx"]::before,
.b3-typography [href ^="assets/"][href $=".docx"]::before,
.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".doc"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".doc"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".doc"]::before,
.b3-typography [href ^="assets/"][href $=".doc"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/word_icon.svg');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".txt"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".txt"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".txt"]::before,
.b3-typography [href ^="assets/"][href $=".txt"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/txt.svg');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".py"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".py"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".py"]::before,
.b3-typography [href ^="assets/"][href $=".py"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/python_icon.svg');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".R"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".R"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".R"]::before,
.b3-typography [href ^="assets/"][href $=".R"]::before,
.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".r"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".r"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".r"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".r"]::before,
.b3-typography [href ^="assets/"][href $=".r"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/r_lang.svg');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".js"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".js"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".js"]::before,
.b3-typography [href ^="assets/"][href $=".js"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/js.svg');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".html"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".html"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".html"]::before,
.b3-typography [href ^="assets/"][href $=".html"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/html.svg');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".css"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".css"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".css"]::before,
.b3-typography [href ^="assets/"][href $=".css"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/css.svg');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".md"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".md"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".md"]::before,
.b3-typography [href ^="assets/"][href $=".md"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/logo-markdown.svg');
}

.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href $=".ipynb"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href $=".ipynb"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] a[href $=".ipynb"]::before,
.b3-typography [href ^="assets/"][href $=".ipynb"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/jupyter.svg');
}

/* 备注链接 */
.protyle-wysiwyg [data-node-id] span[data-type="a"][data-href^="备注"],
.protyle-wysiwyg [data-node-id] span[data-type="url"][data-href^="备注"],
.protyle-wysiwyg [data-node-id] a[href^="备注"]::before,
.b3-typography a[href^="备注"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/memo.svg');
}

/* 外部链接基础样式 */
.protyle-wysiwyg [data-node-id] span[data-type~='a'][data-href ^="http"]:not(:empty)::before,
.protyle-wysiwyg [data-node-id] span[data-type~='url'][data-href ^="http"]:not(:empty)::before,
.b3-typography a[href ^="http"]::before,
.protyle-wysiwyg [data-node-id] a[href^="http"]::before {
    content: "";
    background-image: url('plugins/link-icon/icon/net2.svg');
}
